<% form_for @user_profile do |f| %>
  <%= f.error_messages %>

<%= render :partial => 'user_info' %>
  <p>
    <% if @user_profile_entries %>
      <% @user_profile_entries.each do |entry| %>
        <% args = entry.prepare_form_helpers %>
        <p>
          <%= label "user_profile_entries[#{entry.id}]", "#{entry.field_name}" %><br/>

          <% if ["text_field", "select", "text_area"].include? entry.display_type %>
            <%= send(entry.display_type, *args) %>
          <% elsif entry.display_type == "picture_link" %>
            <%= send("text_field", *args) %>
            
            
          <% elsif entry.display_type == "upload_pic" %>

            <div class="photo">
              <% fields_for "user_profile[user_profile_pic_attributes][]", user_profile_pic do |p| %>
                <p>
                  <%= p.file_field :photo, :index => nil %>
                  <%= link_to_function "delete", "remove_field($(this), ('user_profile_pic'))" %>
                </p>
              <% end %>
            </div>
            
            
            
          <% elsif ["radio_button"].include? entry.display_type %>
            <% args.each do |options| %>
              <%= send(entry.display_type, *options) %>
              <%= label "user_profile_entries[#{entry.id}]", "#{options.third}" %>
            <% end %>
          <% elsif ["check_box"].include? entry.display_type %>
            <% args.each do |options| %>
              <%= send(entry.display_type, *options) %>
              <%= label "user_profile_entries[#{entry.id}]", "#{options.second}" %>
          <% end %>
        <% end %>

      <% end %>
    <% end %>
  </p>

  <p><%= f.submit "Update" %></p>

<% end %>

